//
//  Timer.swift
//  HALTeacher
//
//  Created by Toshiki Higaki on 2015/07/26.
//  Copyright (c) 2015年 mycompany. All rights reserved.
//

import Foundation

/**
タイマーのプロトコル
*/
@objc protocol TimerDelegate {
    optional func setTimerText(time: String, timeNum: Int)
}

@objc protocol SecondViewsTimerDelegate {
    optional func setTimerText(time: String, timeNum: Int)
}


class Timer: NSObject {
    var delegate: TimerDelegate!
    
    var secondDelegate: SecondViewsTimerDelegate!

    //カウントダウン変数
    var timeCountDown: Int = 1

    // Singletonインスタンス
    static var timerInstance = Timer()
    
    var timerCount: Int = 0
    var nsTimer: NSTimer!
    
    func setTimer(){
        
    }
    
    
    /**
    タイマー開始
    :time :制限時間
    */
    func startTimer(time:Int) {
        self.nsTimer = NSTimer.scheduledTimerWithTimeInterval(1, target: self, selector: Selector("upDateTimer:"), userInfo: nil, repeats: true)
        timerCount = time
    }
    
    
    /**
    タイマーのカウントごとの処理
    */
    func upDateTimer(timer: NSTimer){
        self.timerCount -= timeCountDown
        self.delegate?.setTimerText?(String("\(self.timerCount)"), timeNum: timerCount)
        self.secondDelegate?.setTimerText?(String("\(self.timerCount)"), timeNum: timerCount)
        
        //以下になってたから残り１秒残ってても終了するので直した
        if self.timerCount == 0 {
            if timer.valid{
                timer.invalidate()
                // 終了通知
                CoreCentralManager.coreCentralInstance.sendWritingRequest(CoreCentralManager.coreCentralInstance.quizFinishUUID, sendData: "finish")
                
                self.delegate?.setTimerText?("しゅーりょー", timeNum: timerCount)
                self.secondDelegate?.setTimerText?("Finish!", timeNum: timerCount)
            }
        }
    }
}